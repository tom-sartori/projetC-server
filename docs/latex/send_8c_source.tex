\hypertarget{send_8c_source}{}\doxysection{send.\+c}
\label{send_8c_source}\index{src/socket/send.c@{src/socket/send.c}}
\mbox{\hyperlink{send_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00008}\mbox{\hyperlink{send_8c_a592e2bf7700b3e975ea53992cf1a7a99}{00008}} \textcolor{keywordtype}{void} \mbox{\hyperlink{send_8c_a592e2bf7700b3e975ea53992cf1a7a99}{sendMessageInt}} (\textcolor{keywordtype}{int} acceptedSocketDescriptor, \textcolor{keywordtype}{int} messageInt) \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00009}00009     \textcolor{comment}{// Sending the message's size to the client.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00010}00010     \textcolor{keywordflow}{if}(send(acceptedSocketDescriptor, \&messageInt, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}), 0) == -\/1)\{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00011}00011         \mbox{\hyperlink{error_8c_ad5fd1194b361cfb4bc723c13d4b2182b}{throwError}}(\textcolor{stringliteral}{"{}Erreur lors de l'envoi du message. \(\backslash\)n"{}}, 1);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00012}00012     \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00013}00013     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00014}00014         printf(\textcolor{stringliteral}{"{}Taille du message envoyée. \(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00015}00015     \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00016}00016 \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00025}\mbox{\hyperlink{send_8c_adfc2559fd434eeb9067159920b6d7d19}{00025}} \textcolor{keywordtype}{void} \mbox{\hyperlink{send_8c_adfc2559fd434eeb9067159920b6d7d19}{sendMessageString}} (\textcolor{keywordtype}{int} acceptedSocketDescriptor, \textcolor{keywordtype}{char} *message, \textcolor{keywordtype}{int} size) \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00026}00026     \textcolor{comment}{// Sending the message to the client.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00027}00027     \textcolor{keywordflow}{if}(send(acceptedSocketDescriptor, message, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}) * size, 0) == -\/1)\{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00028}00028         \mbox{\hyperlink{error_8c_ad5fd1194b361cfb4bc723c13d4b2182b}{throwError}}(\textcolor{stringliteral}{"{}Erreur lors de l'envoi du message. \(\backslash\)n"{}}, 1);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00029}00029     \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00030}00030     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00031}00031         printf(\textcolor{stringliteral}{"{}Message envoyé. \(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00032}00032     \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00033}00033 \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00043}\mbox{\hyperlink{send_8c_ad0918a45bba2cf75a7b3b13e1e4e1e92}{00043}} \textcolor{keywordtype}{void} \mbox{\hyperlink{send_8c_ad0918a45bba2cf75a7b3b13e1e4e1e92}{sendMessage}} (\textcolor{keywordtype}{int} acceptedSocketDescriptor, \textcolor{keywordtype}{char} *message) \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00044}00044     \textcolor{keywordtype}{int} messageSize = (int)strlen(message);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00045}00045     printf(\textcolor{stringliteral}{"{}Size of sent message: \%d \(\backslash\)n"{}}, messageSize);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00046}00046     \textcolor{comment}{// Send message messageSize.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00047}00047     \mbox{\hyperlink{send_8c_a592e2bf7700b3e975ea53992cf1a7a99}{sendMessageInt}}(acceptedSocketDescriptor, messageSize);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00048}00048     \textcolor{comment}{// Send message.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00049}00049     \mbox{\hyperlink{send_8c_adfc2559fd434eeb9067159920b6d7d19}{sendMessageString}}(acceptedSocketDescriptor, message, messageSize);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00050}00050 \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00051}00051 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00058}\mbox{\hyperlink{send_8c_a7c3db8391bee9ddd7d4d297ee83d5778}{00058}} \textcolor{keywordtype}{void} \mbox{\hyperlink{send_8c_a7c3db8391bee9ddd7d4d297ee83d5778}{sendToChannel}} (\mbox{\hyperlink{struct_client}{Client}} *client, \textcolor{keywordtype}{char} *message) \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00059}00059     printf(\textcolor{stringliteral}{"{}sendToChannel. \(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00060}00060     \textcolor{keywordflow}{if} (\mbox{\hyperlink{_list_8c_ac5b3cc3f57d146c45ed97a020807074c}{isEmpty}}(\mbox{\hyperlink{global_8c_a8bbe5cfb41fbe6b27337c128ed94cf2c}{clientList}})) \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00061}00061         \mbox{\hyperlink{error_8c_ad5fd1194b361cfb4bc723c13d4b2182b}{throwError}}(\textcolor{stringliteral}{"{}Client list empty. "{}}, 0);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00062}00062     \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00064}00064     \mbox{\hyperlink{struct_node}{Node}} *current = \mbox{\hyperlink{_list_8c_a747eb18625a1312ab4b20c9bd2fc6508}{next}}(\mbox{\hyperlink{global_8c_a86cd9048b82fd91e3260fd17b880d223}{channelList}}[client-\/>\mbox{\hyperlink{struct_client_ac68008534f800db5b81ce5d08d0dc768}{indexCurrentChannel}}]-\/>\mbox{\hyperlink{struct_channel_a8bbe5cfb41fbe6b27337c128ed94cf2c}{clientList}}-\/>\mbox{\hyperlink{struct_list_aa3e81b47ac0637ebb1ea7cc12812405a}{head}});}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00065}00065     \textcolor{keywordflow}{while} (current != NULL) \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00066}00066         \textcolor{keywordflow}{if} (\mbox{\hyperlink{client_socket_8c_a2d7d327343fcb081adaced431ae05bd2}{isSocketConnected}}(current-\/>\mbox{\hyperlink{struct_node_af10e4a54385eb944ebb7b2d136388256}{client}}-\/>\mbox{\hyperlink{struct_client_af3026a10afe86549e403ed46b8ff437a}{acceptedSocketDescriptor}})) \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00067}00067             \textcolor{keywordtype}{char} *msgWithClientName;}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00068}00068             \textcolor{keywordtype}{size\_t} msgSize;}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00069}00069             \textcolor{keywordflow}{if}(current-\/>\mbox{\hyperlink{struct_node_af10e4a54385eb944ebb7b2d136388256}{client}}-\/>\mbox{\hyperlink{struct_client_af3026a10afe86549e403ed46b8ff437a}{acceptedSocketDescriptor}} != client-\/>\mbox{\hyperlink{struct_client_af3026a10afe86549e403ed46b8ff437a}{acceptedSocketDescriptor}})\{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00070}00070                 msgSize = strlen(client-\/>\mbox{\hyperlink{struct_client_a9b20c006bd90a09e1465fb668700e81d}{username}})+strlen(message) + 4;}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00071}00071                 msgWithClientName = (\textcolor{keywordtype}{char}*)malloc(msgSize);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00072}00072                 bzero(msgWithClientName, msgSize);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00073}00073                 strcat(msgWithClientName, client-\/>\mbox{\hyperlink{struct_client_a9b20c006bd90a09e1465fb668700e81d}{username}});}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00074}00074             \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00075}00075             \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00076}00076                 msgSize = strlen(message) + 6;}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00077}00077                 msgWithClientName = (\textcolor{keywordtype}{char}*)malloc(msgSize);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00078}00078                 bzero(msgWithClientName, msgSize);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00079}00079                 strcat(msgWithClientName, \textcolor{stringliteral}{"{}Me"{}});}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00080}00080             \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00081}00081             strcat(msgWithClientName,\textcolor{stringliteral}{"{} : "{}});}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00082}00082             strcat(msgWithClientName, message);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00083}00083             \mbox{\hyperlink{send_8c_ad0918a45bba2cf75a7b3b13e1e4e1e92}{sendMessage}}(current-\/>\mbox{\hyperlink{struct_node_af10e4a54385eb944ebb7b2d136388256}{client}}-\/>\mbox{\hyperlink{struct_client_af3026a10afe86549e403ed46b8ff437a}{acceptedSocketDescriptor}}, msgWithClientName);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00084}00084             free(msgWithClientName);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00085}00085         \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00086}00086         current = \mbox{\hyperlink{_list_8c_a747eb18625a1312ab4b20c9bd2fc6508}{next}}(current);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00087}00087     \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00088}00088 \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00097}\mbox{\hyperlink{send_8c_a4baf4d0414081a482415084713b917b6}{00097}} \textcolor{keywordtype}{void} \mbox{\hyperlink{send_8c_a4baf4d0414081a482415084713b917b6}{sendFile}}(\textcolor{keywordtype}{int} clientSocketForFile, FILE *file)\{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00098}00098     \textcolor{comment}{// Get file blocSize.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00099}00099     \textcolor{keywordtype}{long} fileSize;}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00100}00100     fseek(file, 0, SEEK\_END);           \textcolor{comment}{// Jump to the end of the file.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00101}00101     fileSize = ftell(file);             \textcolor{comment}{// Get the current byte offset in the file.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00102}00102     rewind(file);                      \textcolor{comment}{// Jump back to the beginning of the file.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00103}00103 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00104}00104     \textcolor{comment}{// Send file blocSize to the server.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00105}00105     send(clientSocketForFile, \&fileSize, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{long}), 0);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00107}00107     \textcolor{comment}{// Send the file bloc per bloc.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00108}00108     \textcolor{keywordtype}{long} blocSize = \mbox{\hyperlink{global_8c_a4da35cd01e3a4eb2711d8531f9fefdd7}{MAX\_SIZE\_SENT}};}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00109}00109     \textcolor{keywordtype}{char} subBuffer[blocSize];}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00110}00110     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < fileSize; i += \mbox{\hyperlink{global_8c_a4da35cd01e3a4eb2711d8531f9fefdd7}{MAX\_SIZE\_SENT}}) \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00111}00111         blocSize = (i + \mbox{\hyperlink{global_8c_a4da35cd01e3a4eb2711d8531f9fefdd7}{MAX\_SIZE\_SENT}} < fileSize) ? \mbox{\hyperlink{global_8c_a4da35cd01e3a4eb2711d8531f9fefdd7}{MAX\_SIZE\_SENT}} : fileSize -\/ i;   \textcolor{comment}{// Calcul the bloc's size.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00112}00112         fread(subBuffer, blocSize, 1, file); \textcolor{comment}{// Read in the file.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00113}00113 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00114}00114         \textcolor{keywordflow}{if} (send(clientSocketForFile, subBuffer, \textcolor{keyword}{sizeof}(subBuffer), 0) == -\/1) \{   \textcolor{comment}{// Send bloc of data.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00115}00115             \mbox{\hyperlink{error_8c_ad5fd1194b361cfb4bc723c13d4b2182b}{throwError}}(\textcolor{stringliteral}{"{}Error in sending file. \(\backslash\)n"{}}, 1);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00116}00116         \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00117}00117         bzero(subBuffer, \mbox{\hyperlink{global_8c_a4da35cd01e3a4eb2711d8531f9fefdd7}{MAX\_SIZE\_SENT}});    \textcolor{comment}{// Clear the buffer.}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00118}00118     \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00119}00119 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00120}00120     fclose(file); \textcolor{comment}{// Close the file}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00121}00121     printf(\textcolor{stringliteral}{"{}File sent. \(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00122}00122 \}}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{send_8c_source_l00129}\mbox{\hyperlink{send_8c_ae43456bfb14820623a3d579cb841ddc0}{00129}} \textcolor{keywordtype}{void} \mbox{\hyperlink{send_8c_ae43456bfb14820623a3d579cb841ddc0}{sendPort}} (\textcolor{keywordtype}{int} port) \{}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00130}00130     \textcolor{keywordtype}{int} clientSwitchSocket = \mbox{\hyperlink{client_socket_8c_a4cfd20ed36939fbc7c7ab4a583296212}{connectToClient}}(\mbox{\hyperlink{global_8c_a86cd9048b82fd91e3260fd17b880d223}{channelList}}[\mbox{\hyperlink{global_8c_a084563befd809c1db2ff54100af846d2}{INDEX\_SWITCH\_CHANNEL}}]-\/>serverSocketDescriptor);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00131}00131     \mbox{\hyperlink{send_8c_a592e2bf7700b3e975ea53992cf1a7a99}{sendMessageInt}}(clientSwitchSocket, port);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00132}00132     close(clientSwitchSocket);}
\DoxyCodeLine{\Hypertarget{send_8c_source_l00133}00133 \}}

\end{DoxyCode}
